<!-- The exported code uses Tailwind CSS. Install Tailwind CSS in your dev environment to ensure all styles work. -->
<template>
    <div class="min-h-screen bg-gray-50">
        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="max-w-[1024px] mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
            <!-- ÌéòÏù¥ÏßÄ ÌÉÄÏù¥ÌãÄ -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">ÎßàÏù¥ÌéòÏù¥ÏßÄ</h1>
                <!-- ÏóêÎü¨ Î©îÏãúÏßÄ -->
                <div
                    v-if="error"
                    class="mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"
                >
                    {{ error }}
                </div>
            </div>

            <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
            <TabNavigation :active-tab="activeTab" @update:active-tab="activeTab = $event" />

            <!-- Î°úÎî© ÏÉÅÌÉú -->
            <div v-if="loading" class="flex justify-center items-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400"></div>
                <span class="ml-3 text-gray-600">Î°úÎî© Ï§ë...</span>
            </div>

            <!-- ÌÉ≠ ÏΩòÌÖêÏ∏† -->
            <div v-else class="relative overflow-hidden">
                <div
                    class="flex transition-transform duration-300 ease-in-out"
                    :style="{
                        transform: `translateX(${activeTab === 'info' ? '0%' : '-100%'})`,
                    }"
                >
                    <!-- ÎÇ¥ Ï†ïÎ≥¥ ÌÉ≠ -->
                    <div class="w-full flex-shrink-0 py-6 px-4">
                        <UserInfoCard
                            :user-info="userInfo"
                            :loading="loading"
                            @update:user-info="handleUserInfoUpdate"
                            @update-completed="handleUpdateCompleted"
                        />
                    </div>

                    <!-- ÎÇ¥ ÌôúÎèô ÌÉ≠ -->
                    <div class="w-full flex-shrink-0 py-6 px-4">
                        <LikedProjectsSection
                            :likedProjects="likedProjects"
                            :liked-fundings="likedFundings"
                            @toggle-like="handleProjectToggleLike"
                        />
                        <ParticipatingFundingsSection
                            :participating-fundings="participatingFundings"
                            @update:participating-fundings="participatingFundings = $event"
                        />
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, onMounted, reactive } from 'vue'
import {
    getMyPageInfo,
    getMyKeywords,
    updateMyKeywords,
    updateAccountInfo,
    getMyVotes,
    getMyProjects,
    getMyAllSavings,
    getMyAllLoans,
    getMyAllDonations,
    getMyAllChallenges,
    getLikedFundings,
    getMyAllVotedFunds,
    getProjectDetail,
    toggleProjectLike,
} from '@/api/mypageApi'
import { getUserBadges } from '@/api/badgeApi'
import { useAuthStore } from '@/stores/auth'

// Ïª¥Ìè¨ÎÑåÌä∏ import
import TabNavigation from '@/components/mypage/TabNavigation.vue'
import UserInfoCard from '@/components/mypage/UserInfoCard.vue'
import LikedProjectsSection from '@/components/mypage/LikedProjectsSection.vue'
import ParticipatingFundingsSection from '@/components/mypage/ParticipatingFundingsSection.vue'

const authStore = useAuthStore()
const token = authStore.loadToken()

// ÌÜ†ÌÅ∞ ÎîîÎ≤ÑÍπÖ
console.log('üîë ÌÜ†ÌÅ∞ ÌôïÏù∏:', token)
console.log('üîë ÌÜ†ÌÅ∞ ÌÉÄÏûÖ:', typeof token)
console.log('üîë ÌÜ†ÌÅ∞ Í∏∏Ïù¥:', token ? token.length : 0)

const activeTab = ref('info')
const showUserMenu = ref(false)
const loading = ref(false)
const error = ref(null)

// ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
const userInfo = reactive({
    userId: null,
    username: '',
    email: '',
    nickname: '',
    phoneNumber: '',
    role: '',
    createAt: '',
    totalVotes: 0,
    totalProjects: 0,
    keywords: [],
    badges: [],
})

const notifications = ref([
    { id: 1, message: 'ÏÉàÎ°úÏö¥ ÌéÄÎî©Ïù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.' },
    { id: 2, message: 'ÌöåÏõêÎãòÏùò ÌéÄÎî©Ïù¥ ÎßàÍ∞êÎêòÏóàÏäµÎãàÎã§.' },
])

const toggleUserMenu = () => {
    showUserMenu.value = !showUserMenu.value
}

const toDate = (v) => {
    if (!v) return null
    if (v instanceof Date) return v
    if (Array.isArray(v)) {
        const [y, m, d, hh = 0, mm = 0, ss = 0] = v
        return new Date(y, (m ?? 1) - 1, d ?? 1, hh, mm, ss)
    }
    return new Date(v)
}

const formatDate = (val) => {
    const dt = toDate(val)
    if (!dt || isNaN(dt)) return ''
    const y = dt.getFullYear()
    const m = String(dt.getMonth() + 1).padStart(2, '0')
    const d = String(dt.getDate()).padStart(2, '0')
    return `${y}-${m}-${d}`
}

// Î±ÉÏßÄ Ï†ïÎ≥¥ Î°úÎìú
const loadUserBadges = async () => {
    try {
        console.log('Î±ÉÏßÄ Ï†ïÎ≥¥ Î°úÎìú ÏãúÏûë')
        const badges = await getUserBadges(token)
        console.log('Î±ÉÏßÄ Ï†ïÎ≥¥ Î°úÎìú ÏôÑÎ£å:', badges)
        userInfo.badges = badges || []
    } catch (err) {
        console.error('Î±ÉÏßÄ Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', err)
        // API Ïã§Ìå® Ïãú Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
        userInfo.badges = []

        // Mock Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥ (ÌÖåÏä§Ìä∏Ïö©)
        userInfo.badges = [
            {
                badgeId: 1,
                name: 'CertifiedCompany4 (ÏóÖÏ≤¥ Ïù∏Ï¶ù)',
                description: 'ÏóÖÏ≤¥ Ïù∏Ï¶ù (Company Certification)',
                autoGrantCondition: 'COMPLETED_FUNDING',
            },
            {
                badgeId: 3,
                name: 'Donor (Í∏∞Î∂ÄÍ∞Ä)',
                description: 'Í∏∞Î∂ÄÍ∞Ä (Donor)',
                autoGrantCondition: 'DONATED',
            },
            {
                badgeId: 4,
                name: 'Challenger (Ï±åÎ¶∞Ï†Ä)',
                description: 'Ï±åÎ¶∞Ï†Ä (Challenger)',
                autoGrantCondition: 'CHALLENGE_PARTICIPATION',
            },
            {
                badgeId: 8,
                name: 'CommentKing (ÎåìÍ∏ÄÏôï)',
                description: 'ÎåìÍ∏ÄÏôï (Comment King)',
                autoGrantCondition: 'COMMENT_MASTER',
            },
        ]
    }
}

// ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ Î°úÎìú
const loadMyPageInfo = async () => {
    try {
        loading.value = true
        error.value = null
        const data = await getMyPageInfo(token)

        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        Object.assign(userInfo, data)

        // Í∞ÄÏûÖÏùº ÎÇ†Ïßú ÌòïÏãù Ï≤òÎ¶¨
        if (userInfo.createAt) {
            try {
                const date = new Date(userInfo.createAt)
                if (isNaN(date.getTime())) {
                    // ÎÇ†ÏßúÍ∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ ÌòÑÏû¨ ÎÇ†ÏßúÎ°ú ÏÑ§Ï†ï
                    userInfo.createAt = new Date().toISOString()
                }
            } catch (err) {
                console.error('ÎÇ†Ïßú ÌååÏã± Ïò§Î•ò:', err)
                userInfo.createAt = new Date().toISOString()
            }
        }

        // ÌÇ§ÏõåÎìú Ï†ïÎ≥¥Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ Îπà Î∞∞Ïó¥Î°ú Ï¥àÍ∏∞Ìôî
        if (!userInfo.keywords) {
            userInfo.keywords = []
        }

        // Î±ÉÏßÄ Ï†ïÎ≥¥ Î°úÎìú
        await loadUserBadges()
    } catch (err) {
        error.value = err.response?.data?.error || 'ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.'
        console.error('ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:', err)

        // Mock Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
        Object.assign(userInfo, {
            userId: 1,
            username: 'ÍπÄÌéÄÎî©',
            email: 'funding@example.com',
            nickname: 'ÌéÄÎî©Îü¨Î≤Ñ',
            phoneNumber: '010-1234-5678',
            role: 'ROLE_NORMAL',
            createAt: '2024-01-15T00:00:00',
            totalVotes: 5,
            totalProjects: 2,
            keywords: [
                { keywordId: 1, name: 'Ïö¥Îèô' },
                { keywordId: 2, name: 'Î¥âÏÇ¨' },
                { keywordId: 3, name: 'ÎßàÏùå Í±¥Í∞ï' },
            ],
            badges: [],
        })

        // Î±ÉÏßÄ Ï†ïÎ≥¥ÎèÑ Î°úÎìú
        await loadUserBadges()
    } finally {
        loading.value = false
    }
}

// Ï¢ãÏïÑÏöîÌïú ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú
const loadLikedProjects = async () => {
    try {
        console.log('Ï¢ãÏïÑÏöîÌïú ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú ÏãúÏûë - token:', token)
        const votes = await getMyVotes(token)
        console.log('API ÏùëÎãµ - votes:', votes)

        // ÌîÑÎ°úÏ†ùÌä∏ ID Î™©Î°ù Ï∂îÏ∂ú
        const projectIds = votes
        console.log('ÌîÑÎ°úÏ†ùÌä∏ ID Î™©Î°ù:', projectIds)

        // Í∞Å ÌîÑÎ°úÏ†ùÌä∏Ïùò ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Í∏∞
        const projectDetails = await Promise.all(
            projectIds.map(async (projectId) => {
                try {
                    const detail = await getProjectDetail(projectId, token)
                    console.log(`ÌîÑÎ°úÏ†ùÌä∏ ${projectId} ÏÉÅÏÑ∏ Ï†ïÎ≥¥:`, detail)
                    return detail
                } catch (error) {
                    console.error(`ÌîÑÎ°úÏ†ùÌä∏ ${projectId} ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®:`, error)
                    return null
                }
            }),
        )

        likedProjects.value = projectDetails
            .filter((project) => project !== null)
            .map((project) => {
                console.log('ÌîÑÎ°úÏ†ùÌä∏ ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞:', project)

                const transformedProject = {
                    type: project.basicInfo.projectType,
                    likes: project.voteCount,
                    title: project.basicInfo.title,
                    description: project.basicInfo.promotion,
                    createdAt: formatDate(project.basicInfo.createAt),
                    status:
                        project.basicInfo.progress === 'Active'
                            ? 'ÏßÑÌñâÏ§ë'
                            : project.basicInfo.progress === 'Close'
                              ? 'ÎßàÍ∞ê'
                              : 'Ï§ÄÎπÑÏ§ë',
                    id: project.basicInfo.projectId,
                    image: project.imageList?.[0]?.imageUrl,
                    isLiked: true,
                }

                console.log('Î≥ÄÌôòÎêú ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞:', transformedProject)
                return transformedProject
            })

        console.log('Î≥ÄÌôòÎêú likedProjects:', likedProjects.value)
    } catch (err) {
        console.error('Ï¢ãÏïÑÏöîÌïú ÌîÑÎ°úÏ†ùÌä∏ Î°úÎìú Ïã§Ìå®:', err)
        console.error('ÏóêÎü¨ ÏÉÅÏÑ∏:', err.response?.data)
        // API Ïã§Ìå® Ïãú Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
        likedProjects.value = []
        console.log('API Ïã§Ìå®Î°ú Îπà Î∞∞Ïó¥ ÏÑ§Ï†ï')
    }
}

// Ï∞∏Ïó¨ Ï§ëÏù∏ ÌéÄÎî© Î°úÎìú
const loadParticipatingFundings = async () => {
    try {
        // ÌÉÄÏûÖÎ≥ÑÎ°ú API Ìò∏Ï∂ú
        const [savings, loans, donations, challenges] = await Promise.all([
            getMyAllSavings(token),
            getMyAllLoans(token),
            getMyAllDonations(token),
            getMyAllChallenges(token),
        ])

        // Í∞Å ÌÉÄÏûÖÎ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º ÌÜµÌï©
        const allFundings = []

        // Ï†ÄÏ∂ï Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        console.log('Ï†ÄÏ∂ï Îç∞Ïù¥ÌÑ∞ ÏõêÎ≥∏:', savings)
        savings.forEach((saving) => {
            console.log('Ï†ÄÏ∂ï Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë:', saving)
            const savingImage =
                saving.images && saving.images.length > 0
                    ? saving.images[0].imageUrl
                    : `https://readdy.ai/api/search-image?query=savings%20product&width=150&height=150&seq=saving${saving.userSavingId}`

            allFundings.push({
                id: saving.userSavingId,
                title: saving.savingName || 'Ï†ÄÏ∂ï ÏÉÅÌíà',
                joinDate: `Ï∞∏Ïó¨Ïùº: ${new Date().toLocaleDateString('ko-KR')}`,
                amount: saving.savingAmount || 0,
                type: 'saving',
                fundId: saving.productId,
                status: 'ÏßÑÌñâÏ§ë',
                thumbnail: savingImage,
            })
        })

        // ÎåÄÏ∂ú Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        console.log('ÎåÄÏ∂ú Îç∞Ïù¥ÌÑ∞ ÏõêÎ≥∏:', loans)
        loans.forEach((loan) => {
            console.log('ÎåÄÏ∂ú Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë:', loan)
            const loanImage =
                loan.images && loan.images.length > 0
                    ? loan.images[0].imageUrl
                    : `https://readdy.ai/api/search-image?query=loan%20product&width=150&height=150&seq=loan${loan.userLoanId}`

            allFundings.push({
                id: loan.userLoanId,
                title: loan.loanName || 'ÎåÄÏ∂ú ÏÉÅÌíà',
                joinDate: `Ï∞∏Ïó¨Ïùº: ${new Date().toLocaleDateString('ko-KR')}`,
                amount: loan.loanAmount || 0,
                type: 'loan',
                fundId: loan.productId,
                status: 'ÏßÑÌñâÏ§ë',
                thumbnail: loanImage,
            })
        })

        // Í∏∞Î∂Ä Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        console.log('Í∏∞Î∂Ä Îç∞Ïù¥ÌÑ∞ ÏõêÎ≥∏:', donations)
        donations.forEach((donation) => {
            console.log('Í∏∞Î∂Ä Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë:', donation)
            const donationImage =
                donation.images && donation.images.length > 0
                    ? donation.images[0].imageUrl
                    : `https://readdy.ai/api/search-image?query=donation%20product&width=150&height=150&seq=donation${donation.userDonationId}`

            allFundings.push({
                id: donation.userDonationId,
                title: donation.donationName || 'Í∏∞Î∂Ä ÏÉÅÌíà',
                joinDate: `Ï∞∏Ïó¨Ïùº: ${new Date().toLocaleDateString('ko-KR')}`,
                amount: donation.donationAmount || 0,
                type: 'donation',
                fundId: donation.productId,
                status: 'ÏßÑÌñâÏ§ë',
                thumbnail: donationImage,
            })
        })

        // Ï±åÎ¶∞ÏßÄ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        console.log('Ï±åÎ¶∞ÏßÄ Îç∞Ïù¥ÌÑ∞ ÏõêÎ≥∏:', challenges)
        challenges.forEach((challenge) => {
            console.log('Ï±åÎ¶∞ÏßÄ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Ï§ë:', challenge)
            console.log('Ï±åÎ¶∞ÏßÄ productId:', challenge.productId)
            console.log('Ï±åÎ¶∞ÏßÄ userChallengeId:', challenge.userChallengeId)

            const challengeImage =
                challenge.challengeImageUrl ||
                `https://readdy.ai/api/search-image?query=challenge%20product&width=150&height=150&seq=challenge${challenge.userChallengeId}`

            const challengeData = {
                id: challenge.userChallengeId,
                title: challenge.challengeName || 'Ï±åÎ¶∞ÏßÄ',
                joinDate: `Ï∞∏Ïó¨Ïùº: ${new Date().toLocaleDateString('ko-KR')}`,
                amount: 0,
                type: 'challenge',
                fundId: challenge.fundId, // userChallengeIdÎ•º ÏÇ¨Ïö©Ìï¥Î≥¥Í∏∞
                status: challenge.challengeStatus || 'ÏßÑÌñâÏ§ë',
                thumbnail: challengeImage,
            }

            console.log('ÏÉùÏÑ±Îêú Ï±åÎ¶∞ÏßÄ Îç∞Ïù¥ÌÑ∞:', challengeData)
            allFundings.push(challengeData)
        })

        participatingFundings.value = allFundings
        console.log('Ï∞∏Ïó¨Ï§ëÏù∏ ÌéÄÎî© Îç∞Ïù¥ÌÑ∞:', participatingFundings.value)
        console.log('Ï¥ù Ï∞∏Ïó¨ ÌéÄÎî© Ïàò:', allFundings.length)

        // Í∞Å ÌÉÄÏûÖÎ≥Ñ Í∞úÏàò Î°úÍπÖ
        const typeCounts = allFundings.reduce((acc, funding) => {
            acc[funding.type] = (acc[funding.type] || 0) + 1
            return acc
        }, {})
        console.log('ÌÉÄÏûÖÎ≥Ñ Ï∞∏Ïó¨ ÌéÄÎî© Í∞úÏàò:', typeCounts)
    } catch (err) {
        console.error('Ï∞∏Ïó¨ Ï§ëÏù∏ ÌéÄÎî© Î°úÎìú Ïã§Ìå®:', err)
        console.error('ÏóêÎü¨ ÏÉÅÏÑ∏:', err.response?.data)
        // API Ïã§Ìå® Ïãú Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
        participatingFundings.value = []
        console.log('API Ïã§Ìå®Î°ú Îπà Î∞∞Ïó¥ ÏÑ§Ï†ï')
    }
}

const likedProjects = ref([])
const likedFundings = ref([])
const participatingFundings = ref([])

// Ï¢ãÏïÑÏöîÌïú ÌéÄÎî© Î°úÎìú
const loadLikedFundings = async () => {
    try {
        console.log('üî• Ï¢ãÏïÑÏöîÌïú ÌéÄÎî© Î°úÎìú ÏãúÏûë - token:', token)
        const votedFundsData = await getMyAllVotedFunds(token)
        console.log('üî• API ÏùëÎãµ - votedFundsData:', votedFundsData)

        // ÏùëÎãµÍ∞í ÌòïÌÉú ÌôïÏù∏ÏùÑ ÏúÑÌïú ÏÉÅÏÑ∏ Î°úÍ∑∏
        if (votedFundsData && votedFundsData.length > 0) {
            console.log('üî• Ï≤´ Î≤àÏß∏ ÌéÄÎî© Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞:', votedFundsData[0])
            console.log('üî• Î™®Îì† ÌéÄÎî© Îç∞Ïù¥ÌÑ∞:', votedFundsData)
        }

        // FundingCard Ïª¥Ìè¨ÎÑåÌä∏Ïóê ÎßûÍ≤å Îç∞Ïù¥ÌÑ∞ Î≥ÄÌôò
        likedFundings.value = votedFundsData.map((funding) => {
            console.log('üî• Î≥ÄÌôò Ï§ëÏù∏ ÌéÄÎî©:', funding)

            const transformedFunding = {
                id: funding.fundId || funding.id,
                fundType: funding.fundType || funding.type || 'Ï†ÄÏ∂ïÌòï',
                title: funding.name || funding.title || 'ÌéÄÎî© Ï†úÎ™©',
                description: funding.description || funding.content || 'ÌéÄÎî© ÏÑ§Î™Ö',
                daysLeft: funding.daysLeft || funding.remainingDays || 0,
                category: funding.category || funding.fundType || 'Ï†ÄÏ∂ïÌòï',
                likes: funding.likes || funding.likeCount || 0,
                progress: funding.progress || funding.progressRate || 0,
                image:
                    funding.imageUrl ||
                    funding.image ||
                    funding.thumbnail ||
                    `https://readdy.ai/api/search-image?query=funding%20thumbnail&width=400&height=300&seq=funding${funding.fundId || funding.id}`,
            }

            console.log('üî• Î≥ÄÌôòÎêú ÌéÄÎî©:', transformedFunding)
            return transformedFunding
        })

        console.log('üî• ÏµúÏ¢Ö Î≥ÄÌôòÎêú likedFundings:', likedFundings.value)
    } catch (err) {
        console.error('üî• Ï¢ãÏïÑÏöîÌïú ÌéÄÎî© Î°úÎìú Ïã§Ìå®:', err)
        console.error('üî• ÏóêÎü¨ ÏÉÅÏÑ∏:', err.response?.data)
        // API Ïã§Ìå® Ïãú Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
        likedFundings.value = []
        console.log('üî• API Ïã§Ìå®Î°ú Îπà Î∞∞Ïó¥ ÏÑ§Ï†ï')
    }
}

const handleUserInfoUpdate = (updatedUserInfo) => {
    // Î°úÏª¨ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Ï¶âÏãú Î∞òÏòÅ)
    Object.assign(userInfo, updatedUserInfo)
}

const handleUpdateCompleted = () => {
    // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏Í∞Ä ÏôÑÎ£åÎêòÏóàÏùÑ Îïå Ìò∏Ï∂úÎêòÎäî Ìï®Ïàò
    // Ïó¨Í∏∞ÏÑúÎäî ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥Î•º Îã§Ïãú Î°úÎìúÌïòÏó¨ ÏµúÏã† ÏÉÅÌÉúÎ•º Î∞òÏòÅ
    loadMyPageInfo()
}

// ÌîÑÎ°úÏ†ùÌä∏ Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä Ï≤òÎ¶¨
const handleProjectToggleLike = async (projectId) => {
    try {
        console.log('ÌîÑÎ°úÏ†ùÌä∏ Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä ÏãúÏûë:', projectId)

        // API Ìò∏Ï∂ú
        await toggleProjectLike(projectId, token)

        // Ï¢ãÏïÑÏöî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        const projectIndex = likedProjects.value.findIndex((p) => p.id === projectId)
        if (projectIndex !== -1) {
            const project = likedProjects.value[projectIndex]
            project.isLiked = !project.isLiked
            project.likes += project.isLiked ? 1 : -1

            // Ï¢ãÏïÑÏöî Ìï¥Ï†úÎêú Í≤ΩÏö∞ Î™©Î°ùÏóêÏÑú Ï†úÍ±∞
            if (!project.isLiked) {
                likedProjects.value.splice(projectIndex, 1)
            }
        }

        console.log('ÌîÑÎ°úÏ†ùÌä∏ Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä ÏôÑÎ£å:', projectId)
    } catch (error) {
        console.error('ÌîÑÎ°úÏ†ùÌä∏ Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä Ïã§Ìå®:', error)
    }
}

onMounted(async () => {
    console.log('MyPage onMounted ÏãúÏûë')
    console.log('ÌòÑÏû¨ token:', token)

    // ÎßàÏù¥ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ Î°úÎìú
    await loadMyPageInfo()

    // ÌôúÎèô ÌÉ≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    console.log('ÌôúÎèô ÌÉ≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÏûë')
    await Promise.all([loadLikedProjects(), loadLikedFundings(), loadParticipatingFundings()])
    console.log('ÌôúÎèô ÌÉ≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å')
    console.log('ÏµúÏ¢Ö likedProjects:', likedProjects.value)
    console.log('ÏµúÏ¢Ö likedFundings:', likedFundings.value)

    document.addEventListener('click', (event) => {
        const userMenuButton = document.getElementById('user-menu-button')
        const userMenuDropdown = userMenuButton?.nextElementSibling
        if (userMenuButton && userMenuDropdown) {
            if (
                !userMenuButton.contains(event.target) &&
                !userMenuDropdown.contains(event.target)
            ) {
                showUserMenu.value = false
            }
        }
    })
})
</script>

<style scoped>
.rounded-button {
    border-radius: 8px;
}

input[type='number']::-webkit-outer-spin-button,
input[type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

input[type='number'] {
    -moz-appearance: textfield;
}
</style>
